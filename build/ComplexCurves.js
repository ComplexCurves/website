/**
 * @license
 *
 * Complex Curves
 *
 * Copyright 2016-2017 Stefan Kranich
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(function(){
'use strict';var k,l={"Assembly.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform sampler2D samplers[1 + N/2];\nuniform float sheet;\nvarying float which;\nvarying vec2 texCoord[3];\n\nvoid readTex (out vec2 pos[3], out float delta[3], out vec2 values[3*N]) {\nvec4 s;\nfor (int i = 0; i < 3; i++) {\ns = texture2D (samplers[0], texCoord[i]);\npos[i] = s.xy;\ndelta[i] = s.z;\nfor (int j = 1; j < N/2; j++) {\ns = texture2D (samplers[j], texCoord[i]);\nvalues[i*N+2*j-2] = s.xy;\nvalues[i*N+2*j-1] = s.zw;\n}\n}\n}\n\nbool valid (in vec2 position[3], in float delta[3]) {\nreturn distance (position[0], position[1]) < min (delta[0], delta[1])\n&& distance (position[1], position[2]) < min (delta[1], delta[2])\n&& distance (position[2], position[0]) < min (delta[2], delta[0]);\n}\n\nvoid main(void) {\nint isheet = int(sheet);\nif (isheet < sheets) {\nvec2 pos[3];\nfloat delta[3];\nvec2 values[3*N];\nreadTex (pos, delta, values);\nif (valid (pos, delta)) {\nfor (int s = 0; s < sheets; s++) {\nif (s == isheet) {\nvec2 valueA = values[s];\nint iwhich = int(which);\nfor (int w = 0; w < 3; w++) {\nif (w == iwhich) {\nvec2 valueWhich = values[w*N];\nfloat dist, minDist = distance (valueA, valueWhich);\nfor (int i = 1; i < sheets; i++) {\ndist = distance (valueA, values[w*N+i]);\nif (dist < minDist)\n{\nvalueWhich = values[w*N+i];\nminDist = dist;\n}\n}\ngl_FragColor = vec4(pos[w], valueWhich);\n}\n}\n}\n}\nreturn;\n}\n}\ngl_FragColor = vec4(-10.0, -10.0, -10.0, 1.0);\n}\n",
"Assembly.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute float index;\nuniform float numIndices;\nuniform float sheet;\nvarying vec2 texCoord[3];\nvarying float which;\n\nvoid main (void) {\ngl_Position = indexedPosition (sheet * numIndices + index);\nwhich = mod (index, 3.0);\ntexCoord[0] = uvPosition (index - which);\ntexCoord[1] = uvPosition (index - which + 1.0);\ntexCoord[2] = uvPosition (index - which + 2.0);\n}\n","CachedSurface.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform bool clipping;\nvarying vec4 vPos;\nvarying vec2 vValue;\nvec3 hue_to_rgb (in float hue)\n{\nhue = mod (degrees (hue), 360.0) / 60.0;\nint h = int (floor (hue));\nfloat f = fract (hue);\nif (h == 0)\nreturn vec3 (1.0, f, 0.0);\nelse if (h == 1)\nreturn vec3 (1.0 - f, 1.0, 0.0);\nelse if (h == 2)\nreturn vec3 (0.0, 1.0, f);\nelse if (h == 3)\nreturn vec3 (0.0, 1.0 - f, 1.0);\nelse if (h == 4)\nreturn vec3 (f, 0.0, 1.0);\nelse if (h == 5)\nreturn vec3 (1.0, 0.0, 1.0 - f);\n}\nfloat sawfct (float x, float dx, float a, float b)\n{\nreturn a + (b - a) * fract (x / dx);\n}\nvoid main (void)\n{\nif (clipping && vPos.y < 0.0)\ndiscard;\nfloat PI = acos (-1.0);\nfloat angle = atan (vValue.y, vValue.x);\nfloat blackp = sawfct (angle, PI / 12.0, 0.7, 1.0);\nfloat blackm = sawfct (log (length (vValue)), PI / 12.0, 0.7, 1.0);\nfloat black = blackp * blackm;\ngl_FragColor = vec4 (black * hue_to_rgb (angle), gl_FragCoord.z);\n}\n",
"CachedSurface.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute vec4 position;\nuniform mat4 m, v, p;\nvarying vec4 vPos;\nvarying vec2 vValue;\nvoid main (void)\n{\nvPos = vec4 (position.xyz, 1.0);\nvValue = position.zw;\ngl_Position = p * v * m * vPos;\n}\n","Common.glsl":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define EPS 5e-3\n\n/* complex division */\nvec2 cd (in vec2 a, in vec2 b) {\n\treturn vec2 (a.x * b.x + a.y * b.y, a.y * b.x - a.x * b.y) / dot (b, b);\n}\n\nvec2 cinv (in vec2 z) {\nreturn vec2(z.x, -z.y) / dot(z, z);\n}\n\n/* complex square root */\nvec2 csqrt (in vec2 z)\n{\nfloat r = sqrt (length (z));\nfloat phi = 0.5 * atan (z.y, z.x);\nreturn r * vec2 (cos (phi), sin (phi));\n}\n\nvec2 horner (in int n, in vec2 cs[N+1], in vec2 x) {\nvec2 p;\nfor (int i = N - 1; i >= 0; i--)\nif (i >= n)\np = cs[i];\nelse if (i < n)\np = cs[i] + cm(p, x);\nreturn p;\n}\n\nvoid weierstrass (in vec2 cs[N+1], out vec2 roots2[N]) {\n\t/* polynomial must be monic! */\nvec2 csn = cs[sheets];\nif (csn != vec2 (1.0, 0.0))\nfor (int i = 0; i <= sheets; i++)\ncs[i] = cd (cs[i], csn);\n\nfloat maxabs = length (cs[0]);\nfor (int i = 1; i < N; i++)\nif (i < sheets)\nmaxabs = max (maxabs, length (cs[i]));\nfloat upperBound = 1.0 + maxabs; /// length (cs[n]);\nfloat phi = 2.0 * acos (-1.0) / float (sheets + 1);\nfloat d = upperBound / float (sheets);\nd = clamp (d, 1.0, 10.0);\n\tfor (int i = 0; i < sheets; i++)\nroots2[i] = float (i) * d * vec2 (cos (float (i) * phi), sin (float (i) * phi));\n\n\tconst int maxiter = 50;\n\tbool changing;\n\tfor (int iter = 0; iter < maxiter; iter++)\n\t{\n\t\tchanging = false;\n\t\tfor (int i = 0; i < sheets; i++)\n{\nvec2 result = vec2 (1.0, 0.0);\nfor (int j = 0; j < sheets; j++)\nif (j != i)\nresult = cm (result, roots2[i] - roots2[j]);\nvec2 update = cd (horner (sheets, cs, roots2[i]), result);\n///* safe-guard against large update */\n//if (sheets > 1 && length (update) > 10)\n//\tupdate /= length (update);\nif (length (update) > 1e-2)\nchanging = true;\nroots2[i] -= update;\n}\nif (!changing)\nbreak;\n\t}\n}\n\nvoid quadratic_roots (in vec2 cs[N+1], out vec2 qroots[2]) {\nif (cs[0] == vec2 (0.0, 0.0)) {\nqroots[0] = vec2 (0.0, 0.0);\nqroots[1] = -cd (cs[1], cs[2]);\n}\nelse\n{\nvec2 r = csqrt (cm (cs[1], cs[1]) - 4.0 * cm (cs[2], cs[0]));\nif (cs[1].x >= 0.0)\nr = -r;\nqroots[0] = cd (r - cs[1], 2.0 * cs[2]);\nqroots[1] = cd (2.0 * cs[0], r - cs[1]);\n}\n}\n\nvoid roots (in int n, in vec2 cs[N+1], out vec2 roots[N])\n{\nif (n == 1) {\nroots[0] = -cd (cs[0], cs[1]);\nreturn;\n}\nif (n == 2) {\nvec2 qroots[2];\nquadratic_roots (cs, qroots);\nroots[0] = qroots[0];\nroots[1] = qroots[1];\nreturn;\n}\nweierstrass (cs, roots);\n/* selection sort by real part */\n/*\nfor(int i = 0; i < n - 1; i++)\n{\nint jmin = i;\nfor (int j = i + 1; j < n; j++)\nif (roots[j].x < roots[jmin].x)\njmin = j;\nvec2 z = roots[i];\nroots[i] = roots[jmin];\nroots[jmin] = z;\n}\n*/\n}\n\nvoid f (in vec2 x, out vec2 cs[N+1]);\nvec2 fx (in vec2 x, in vec2 y);\nvec2 fy (in vec2 x, in vec2 y);\nfloat rho (in vec2 x);\nfloat M (in vec2 x, in float rho);\n\nfloat epsilon (in vec2 ys[N]) {\nfloat d = distance (ys[0], ys[1]);\nif (sheets < 2)\nreturn 1.0 / 0.0;\nfor (int j = 0; j < sheets; j++) {\nfor (int k = 0; k < sheets; k++) {\nif (k > j)\nd = min (d, distance (ys[j], ys[k]));\n}\n}\nreturn d / 2.0;\n}\n\nfloat Y (in vec2 x, in vec2 ys[N]) {\nfloat y = length (cd (fx (x, ys[0]), fy (x, ys[0])));\nfor (int j = 0; j < sheets; j++)\ny = max (y, length (cd (fx (x, ys[j]), fy (x, ys[j]))));\nreturn y;\n}\n\nfloat Delta (in vec2 x, in vec2 ys[N]) {\nfloat eps = epsilon (ys);\nfloat r = rho (x);\nfloat m = M (x, r);\nfloat y = Y (x, ys);\nreturn r * (sqrt (pow (r * y - eps, 2.0) + 4.0 * eps * m) -\n(r * y + eps)) / (2.0 * (m - r * y));\n}\n",
"DomainColouring.frag":"\nuniform int sheet;\nvarying vec2 vPosition;\nvec3 hue_to_rgb (in float hue)\n{\nhue = mod (degrees (hue), 360.0) / 60.0;\nint h = int (floor (hue));\nfloat f = fract (hue);\nif (h == 0)\nreturn vec3 (1.0, f, 0.0);\nelse if (h == 1)\nreturn vec3 (1.0 - f, 1.0, 0.0);\nelse if (h == 2)\nreturn vec3 (0.0, 1.0, f);\nelse if (h == 3)\nreturn vec3 (0.0, 1.0 - f, 1.0);\nelse if (h == 4)\nreturn vec3 (f, 0.0, 1.0);\nelse if (h == 5)\nreturn vec3 (1.0, 0.0, 1.0 - f);\n}\nfloat sawfct (float x, float dx, float a, float b)\n{\nreturn a + (b - a) * fract (x / dx);\n}\nvoid main (void)\n{\nvec2 cs[N+1];\nvec2 ys[N];\nvec2 value;\nf (vPosition, cs);\nroots (sheets, cs, ys);\nint smaller;\nfor (int i = 0; i < sheets; i++)\n{\nsmaller = 0;\nfor (int j = 0; j < sheets; j++)\nif (ys[j].x < ys[i].x)\nsmaller++;\nif (smaller == sheet - 1)\nvalue = ys[i];\n}\n\nfloat PI = acos (-1.0);\nfloat angle = atan (value.y, value.x);\nfloat blackp = sawfct (angle, PI / 12.0, 0.7, 1.0);\nfloat blackm = sawfct (log (length (value)), PI / 12.0, 0.7, 1.0);\nfloat black = blackp * blackm;\ngl_FragColor = vec4 (black * hue_to_rgb(angle), 1.0);\n}\n",
"DomainColouring.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute vec2 position;\nvarying vec2 vPosition;\nvoid main () {\ngl_Position = vec4 (position, 0.0, 1.0);\nvPosition = 5.0 * position;\n}\n","Export.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nvarying vec2 vValue;\nvec3 hue_to_rgb (in float hue)\n{\nhue = mod (degrees (hue), 360.0) / 60.0;\nint h = int (floor (hue));\nfloat f = fract (hue);\nif (h == 0)\nreturn vec3 (1.0, f, 0.0);\nelse if (h == 1)\nreturn vec3 (1.0 - f, 1.0, 0.0);\nelse if (h == 2)\nreturn vec3 (0.0, 1.0, f);\nelse if (h == 3)\nreturn vec3 (0.0, 1.0 - f, 1.0);\nelse if (h == 4)\nreturn vec3 (f, 0.0, 1.0);\nelse if (h == 5)\nreturn vec3 (1.0, 0.0, 1.0 - f);\n}\nfloat sawfct (float x, float dx, float a, float b)\n{\nreturn a + (b - a) * fract (x / dx);\n}\nvoid main (void)\n{\nfloat PI = acos (-1.0);\nfloat angle = atan (vValue.y, vValue.x);\nfloat blackp = sawfct (angle / (2.0 * PI), 0.05, 0.7, 1.0);\nfloat blackm = sawfct (log (length (vValue)), 0.1 * PI, 0.7, 1.0);\nfloat black = blackp * blackm;\ngl_FragColor = vec4 (black * hue_to_rgb(angle), 1.0);\n}\n",
"Export.vert":"\nuniform float maxValue;\nuniform float minValue;\nattribute vec2 vPosition;\nvarying vec2 vValue;\n\nvoid main()\n{\ngl_Position = vec4(vPosition, 0.0, 1.0);\nvValue = 0.5 * (maxValue - minValue) * (vPosition + vec2 (1.0, 1.0))\n+ vec2 (minValue, minValue);\n}\n","FXAA.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform sampler2D u_tex;\nuniform float width;\nuniform float height;\n\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\n// from https://github.com/mitsuhiko/webgl-meincraft/blob/master/assets/shaders/fxaa.glsl\nvec4 applyFXAA(in vec2 fragCoord, in sampler2D tex)\n{\nvec4 color;\nvec2 inverseVP = vec2(1.0 / width, 1.0 / height);\nvec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;\nvec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;\nvec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;\nvec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;\nvec3 rgbM = texture2D(tex, fragCoord * inverseVP).xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM = dot(rgbM, luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, 1.0);\nelse\ncolor = vec4(rgbB, 1.0);\nreturn color;\n}\n\nvoid main (void)\n{\ngl_FragColor = applyFXAA(gl_FragCoord.xy, u_tex);\n}\n",
"FXAA.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute vec2 vPosition;\nvoid main()\n{\ngl_Position = vec4(vPosition, 0.0, 1.0);\n}\n","Initial.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform int computedRoots;\nvarying vec2 vPosition;\nvoid main(void) {\nvec2 position = clamp (vPosition, -5.0, 5.0);\nvec2 values[N];\nvec2 cs[N+1];\nf (position, cs);\nroots (sheets, cs, values);\n\nif (computedRoots < sheets) {\nfor (int i = 0; i < N; i += 2) {\nif (i == computedRoots)\nif (computedRoots + 1 < sheets)\ngl_FragColor = vec4(values[i], values[i + 1]);\nelse\ngl_FragColor = vec4(values[i], vec2 (0.0, 0.0));\n}\n} else {\nfloat delta = Delta (position, values);\ngl_FragColor = vec4 (position, delta, 1.0);\n}\n}\n",
"Initial.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute float index;\nattribute vec2 position;\nvarying vec2 vPosition;\nvoid main (void) {\nvPosition = position;\ngl_Position = indexedPosition (index);\n}\n","Subdivision.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform int computedRoots;\nuniform sampler2D oldSamplers[1 + N/2];\nvarying vec3 barycentric;\nvarying vec2 texCoord[3];\n\nvoid main(void) {\nif (barycentric == vec3 (1.0, 0.0, 0.0)) {\nif (computedRoots >= sheets) {\ngl_FragColor = texture2D (oldSamplers[0], texCoord[0]);\n} else {\nint i = computedRoots / 2 + 1;\nfor (int j = 1; j < 1 + N/2; j++)\nif (j == i)\ngl_FragColor = texture2D (oldSamplers[j], texCoord[0]);\n}\n} else if (barycentric == vec3 (0.0, 1.0, 0.0)) {\nif (computedRoots >= sheets) {\ngl_FragColor = texture2D (oldSamplers[0], texCoord[1]);\n} else {\nint i = computedRoots / 2 + 1;\nfor (int j = 1; j < 1 + N/2; j++)\nif (j == i)\ngl_FragColor = texture2D (oldSamplers[j], texCoord[1]);\n}\n} else if (barycentric == vec3 (0.0, 0.0, 1.0)) {\nif (computedRoots >= sheets) {\ngl_FragColor = texture2D (oldSamplers[0], texCoord[2]);\n} else {\nint i = computedRoots / 2 + 1;\nfor (int j = 1; j < 1 + N/2; j++)\nif (j == i)\ngl_FragColor = texture2D (oldSamplers[j], texCoord[2]);\n}\n} else {\nvec2 values[N];\nvec2 position = barycentric.x * texture2D (oldSamplers[0], texCoord[0]).xy\n+ barycentric.y * texture2D (oldSamplers[0], texCoord[1]).xy\n+ barycentric.z * texture2D (oldSamplers[0], texCoord[2]).xy;\nvec2 cs[N+1];\nf (position, cs);\nroots (sheets, cs, values);\n\nif (computedRoots < sheets) {\nfor (int i = 0; i < N; i += 2) {\nif (i == computedRoots)\nif (computedRoots + 1 < sheets)\ngl_FragColor = vec4(values[i], values[i + 1]);\nelse\ngl_FragColor = vec4(values[i], vec2 (0.0, 0.0));\n}\n} else {\nfloat delta = Delta (position, values);\ngl_FragColor = vec4 (position, delta, 1.0);\n}\n}\n}\n",
"Subdivision.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute vec4 indexBarycentric;\nattribute float indexOffsetIn;\nattribute float indexOffsetOut;\nvarying vec3 barycentric;\nvarying vec2 texCoord[3];\n\nvoid main (void) {\nfloat indexOut = indexBarycentric.x + indexOffsetOut;\ngl_Position = indexedPosition (indexOut);\nbarycentric = indexBarycentric.yzw;\ntexCoord[0] = uvPosition (indexOffsetIn);\ntexCoord[1] = uvPosition (indexOffsetIn + 1.0);\ntexCoord[2] = uvPosition (indexOffsetIn + 2.0);\n}\n",
"SubdivisionPre.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform sampler2D sampler;\nvarying vec2 texCoord[2];\n\nbool validOutgoingEdge () {\nvec3 next = texture2D (sampler, texCoord[1]).xyz;\nreturn distance (gl_FragColor.xy, next.xy) < min (gl_FragColor.z, next.z);\n}\n\nvoid main(void) {\ngl_FragColor = texture2D (sampler, texCoord[0]);\nif (gl_FragColor.w == 1.0 && validOutgoingEdge ())\ngl_FragColor.w = 0.0;\n}\n","SubdivisionPre.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute float index;\nvarying vec2 texCoord[2];\n\nvoid main (void) {\ngl_Position = indexedPosition (index);\nfloat j = 1.0;\nif (mod (index, 3.0) > 1.0)\nj = -2.0;\ntexCoord[0] = uvPosition (index);\ntexCoord[1] = uvPosition (index + j);\n}\n",
"Surface.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform bool clipping;\nvarying vec4 vPos;\nvarying vec2 v_value;\nvec3 hue_to_rgb (in float hue)\n{\nhue = mod (degrees (hue), 360.0) / 60.0;\nint h = int (floor (hue));\nfloat f = fract (hue);\nif (h == 0)\nreturn vec3 (1.0, f, 0.0);\nelse if (h == 1)\nreturn vec3 (1.0 - f, 1.0, 0.0);\nelse if (h == 2)\nreturn vec3 (0.0, 1.0, f);\nelse if (h == 3)\nreturn vec3 (0.0, 1.0 - f, 1.0);\nelse if (h == 4)\nreturn vec3 (f, 0.0, 1.0);\nelse if (h == 5)\nreturn vec3 (1.0, 0.0, 1.0 - f);\n}\nfloat sawfct (float x, float dx, float a, float b)\n{\nreturn a + (b - a) * fract (x / dx);\n}\nvoid main (void)\n{\nif (clipping && vPos.y < 0.0)\ndiscard;\nfloat PI = acos (-1.0);\nfloat angle = atan (v_value.y, v_value.x);\nfloat blackp = sawfct (angle, PI / 12.0, 0.7, 1.0);\nfloat blackm = sawfct (log (length (v_value)), PI / 12.0, 0.7, 1.0);\nfloat black = blackp * blackm;\ngl_FragColor = vec4 (black * hue_to_rgb (angle), gl_FragCoord.z);\n}\n",
"Surface.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform mat4 m;\nuniform mat4 v;\nuniform mat4 p;\nuniform sampler2D sampler;\nattribute float index;\nvarying vec4 vPos;\nvarying vec2 v_value;\nvoid main (void)\n{\nvec4 posValue = texture2D (sampler, uvPosition (index));\nvPos = vec4 (posValue.xyz, 1.0);\nv_value = posValue.zw;\ngl_Position = p * v * m * vPos;\n}\n","Textures.glsl":"\n#define W 2048.0\n#define H 2048.0\nvec2 uvPosition (in float i) {\nconst float h = 2048.0;\nreturn vec2 (mod (i, W) / W + 0.5 / W, floor (i / W) / H + 0.5 / H);\n}\n\nvec4 indexedPosition (in float i) {\nfloat x = mod (i, W) / W;\nfloat y = floor (i / W) / H;\nreturn vec4 (x * 2.0 - 1.0 + 1.0 / W, y * 2.0 - 1.0 + 1.0 / H, 0.0, 1.0);\n}\n"};function u(){}
u.a=function(a){if(null===a)return null;var c=a.type,b=a.value;if("infix"===c){c=u.a(a.first);a=u.a(a.second);if("+"===b)return aa(c,a);if("-"===b)return aa(c,ba(a));if("*"===b)return ca(c,a);if("^"===b){if(da(a)&&(b=ea(a),0<=b.a&&!b.b))return fa(c,b.a);console.error("Illegal exponent")}else console.error("Infix operator '"+b+"' not implemented")}else if("prefix"===c){c=u.a(a.first);if("+"===b)return c;if("-"===b)return ba(c);console.error("Prefix operator '"+b+"' not implemented")}else{if("number"===c)return new v([new w(y(parseFloat(b)),
new A({}))]);if("variable"===c)return c={},c[b]=1,new v([new w(ga,new A(c))]);if("imaginary"===c)return new v([new w(new B(0,1),new A({}))])}return null};u.c=function(a){return 2===C(a).length};
u.b=function(a){function c(a,b){function c(a,b){return{type:"infix",value:b[0].value,first:a,second:b[1]}}return b===[]?a:b.reduce(c,a)}function b(a){a=D(ha(ia(m,d),d),ja(D(m,d)))(a);return null===a?null:c(a[0],a[1])}function d(a){a=D(e,ja(D(q,e)))(a);return null===a?null:c(a[0],a[1])}function e(a){var c=ha(la(b),g,h,n)(a);if(null===c)return null;a=f(a);return null===a?c:{type:"infix",value:"^",first:c,second:a}}function f(a){var b=D(p,g)(a);if(null===b)return null;a=f(a);return null===a?b[1]:{type:"infix",
value:"^",first:b[1],second:a}}a=ma(a);var g=na("number"),h=na("imaginary"),n=na("variable"),m=ha(F("+"),F("-")),q=F("*"),p=F("^");return function(a){a=D(b,oa)(a);return null===a?null:a[0]}(a)};u.f=function(a){return pa(a)};var G=5/12*Math.PI,H=Math.PI/6;function J(a,c,b,d){c=void 0===c?G:c;b=void 0===b?H:b;this.c=a;c=K(c,b);b=new qa;b.C=void 0===d?!1:d;b.j=b.R=b.s=c;this.a=b;this.b=new ra(a);sa(this)}function ta(a,c,b,d,e,f){d=void 0===d?G:d;e=void 0===e?H:e;a=new J(a,d,e,void 0===f?!1:f);d=a.b;d.u=new ua(d,c,b);if(2!==C(c).length||2>d.u.A)return null;L(a);return a}k=J.prototype;k.oa=function(a){var c=this.b;return c.u.ba(c,void 0===a?!1:a)};k.pa=function(a){var c=this.b;c.u.ca(c,void 0===a?"surface.bin":a)};
k.qa=function(a,c){var b=this.b;b.u.da(b,void 0===a?"sheet":a,void 0===c?!0:c)};k.Ca=function(a,c){a=void 0===a?"surface.png":a;c=void 0===c?!1:c;var b=this,d=this.b;va(d,function(){L(b)},c);c=M(d,c?d.B:d.w);N(a,wa(c))};k.ra=function(a,c){var b=this.b;b.u.ea(b,void 0===a?"surface":a,void 0===c?!0:c)};
function sa(a){var c=a.c,b=a.a;a.f=function(c){c.preventDefault();b.o||(xa(b,[c.clientX,c.clientY]),L(a))};a.N=function(a){a.preventDefault();ya(b,a.clientX,a.clientY)};a.O=function(a){a.preventDefault();b.P=[0,0];b.D=!1};a.ma=function(c){c.preventDefault();c=c.touches[0];xa(b,[c.clientX,c.clientY]);L(a)};a.la=function(a){a.preventDefault();a=a.touches[0];ya(b,a.clientX,a.clientY)};a.ka=function(a){a.preventDefault();b.P=[0,0];b.D=!1};a.na=function(c){c.preventDefault();b.G=0<c.deltaY?Math.min(4,
b.G+.1):Math.max(.5,b.G-.1);L(a)};c.addEventListener("mousedown",a.f);c.addEventListener("mousemove",a.N);c.addEventListener("mouseup",a.O);c.addEventListener("touchstart",a.ma);c.addEventListener("touchmove",a.la);c.addEventListener("touchend",a.ka);c.addEventListener("wheel",a.na)}function L(a){var c=a.a;za(a.b,c);if(c.o||c.D||1E-6<Aa(c.j,c.s).abs())Ba(c),requestAnimationFrame(function(){L(a)})}k.Da=function(){this.v(Math.PI/2,Math.PI)};k.Ea=function(){this.v(Math.PI,0)};
k.Fa=function(){this.v(G,H)};k.Ga=function(){this.v(Math.PI/2,0)};k.v=function(a,c){this.a.o=!1;this.a.s=this.a.R=this.a.j;this.a.s=K(a,c);L(this)};k.Ha=function(){this.v(Math.PI/2,-Math.PI/2)};k.Ia=function(){this.v(Math.PI/2,Math.PI/2)};k.Ja=function(){this.v(0,0)};k.sa=function(a){this.b.M=a;L(this)};k.ta=function(a){this.a.o=a;L(this)};k.ua=function(a){this.b.L=a;L(this)};k.Ka=function(a,c){a=K(a,c);this.a.o=!1;this.a.D=!1;this.a.j=this.a.s=a;L(this)};k.va=function(a){this.a.C=a;L(this)};
k.wa=function(a){this.b.S=a;L(this)};k.La=function(a){this.a.G=a||1;L(this)};k.xa=function(){var a=this.b;a.M=!a.M;L(this)};k.ya=function(){var a=this.a;a.o=!a.o;L(this)};k.za=function(){var a=this.b;a.L=!a.L;L(this)};k.Aa=function(){var a=this.a;a.C=!a.C;L(this)};k.Ba=function(){var a=this.b;a.S=!a.S;L(this)};
k.Ma=function(){var a=this.c;a.removeEventListener("mousedown",this.f);a.removeEventListener("mousemove",this.N);a.removeEventListener("mouseup",this.O);a.removeEventListener("touchstart",this.ma);a.removeEventListener("touchmove",this.la);a.removeEventListener("touchend",this.ka);a.removeEventListener("wheel",this.na)};window.ComplexCurves=J;J.fromEquation=function(a,c,b,d,e,f){d=void 0===d?G:d;e=void 0===e?H:e;f=void 0===f?!1:f;c=u.a(u.b(c));return ta(a,c,b,d,e,f)};J.fromFile=function(a,c,b,d,e,f,g){d=void 0===d?G:d;e=void 0===e?H:e;f=void 0===f?!1:f;g=g?g:function(){};b=u.a(u.b(void 0===b?"":b));var h=new J(a,d,e,f);a=h.b;a.u=new Ca(a,c,b,function(){L(h);g()});return h};J.fromPolynomial=ta;J.prototype.domainColouring=J.prototype.oa;J.prototype.exportBinary=J.prototype.pa;J.prototype.exportDomainColouring=J.prototype.qa;
J.prototype.exportScreenshot=J.prototype.Ca;J.prototype.exportSurface=J.prototype.ra;J.prototype.rotateBack=J.prototype.Da;J.prototype.rotateBottom=J.prototype.Ea;J.prototype.rotateDefault=J.prototype.Fa;J.prototype.rotateFront=J.prototype.Ga;J.prototype.rotateLatLong=J.prototype.v;J.prototype.rotateLeft=J.prototype.Ha;J.prototype.rotateRight=J.prototype.Ia;J.prototype.rotateTop=J.prototype.Ja;J.prototype.setAntialiasing=J.prototype.sa;J.prototype.setAutorotate=J.prototype.ta;
J.prototype.setClipping=J.prototype.ua;J.prototype.setLatLong=J.prototype.Ka;J.prototype.setOrtho=J.prototype.va;J.prototype.setTransparency=J.prototype.wa;J.prototype.setZoom=J.prototype.La;J.prototype.toggleAntialiasing=J.prototype.xa;J.prototype.toggleAutorotate=J.prototype.ya;J.prototype.toggleClipping=J.prototype.za;J.prototype.toggleOrtho=J.prototype.Aa;J.prototype.toggleTransparency=J.prototype.Ba;J.prototype.unregisterEventHandlers=J.prototype.Ma;window.PolynomialParser=u;u.eval=u.a;
u.isBivariate=u.c;u.parse=u.b;u.sheets=u.f;function Da(a,c){var b=O("Assembly");b[0]=[c.F,b[0]].join("\n");b[1]=Ea(c,b[1]);this.a=P(a,b)}Da.prototype.a=null;
Da.prototype.l=function(a,c,b){var d=c.h,e=c.m[0];b.useProgram(this.a);var f=c.i;b.uniform1f(b.getUniformLocation(this.a,"numIndices"),f);Fa(c,a);b.vertexAttribPointer(0,1,b.FLOAT,!1,0,0);b.bindFramebuffer(b.FRAMEBUFFER,c.I);b.bindTexture(b.TEXTURE_2D,e);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,e,0);b.bindTexture(b.TEXTURE_2D,null);for(var e=[],g=0,h=d.length;g<h;g++)b.activeTexture(b.TEXTURE0+g),b.bindTexture(b.TEXTURE_2D,d[g]),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,
b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),e[g]=g;b.uniform1iv(b.getUniformLocation(this.a,"samplers"),e);b.disable(b.DEPTH_TEST);b.viewport(0,0,2048,2048);d=b.getUniformLocation(this.a,"sheet");e=0;for(g=c.A;e<g;e++)b.uniform1f(d,e),b.drawArrays(b.POINTS,0,f);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0);b.bindFramebuffer(b.FRAMEBUFFER,
null);b=c.h;c.h=c.m;c.m=b;c.i*=c.A;Fa(c,a)};function Ca(a,c,b,d){d=d?d:function(){};var e=this;e.H=void 0===b?null:b;Ga(e,c,function(){var b=e.W,c=a.g;e.ga=b.byteLength/16;c.enableVertexAttribArray(0);e.X=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,e.X);c.bufferData(c.ARRAY_BUFFER,new Float32Array(b),c.STATIC_DRAW);e.T=P(a,O("CachedSurface"));d()})}k=Ca.prototype;k.ba=function(a,c){return this.H?Ha(this.H,a,void 0===c?!1:c):[]};k.ca=function(a,c){N(void 0===c?"surface.bin":c,this.fa)};
k.da=function(a,c,b){this.H&&Ia(this.H,a,void 0===c?"sheet":c,void 0===b?!0:b)};k.ea=function(a,c,b){c=void 0===c?"surface":c;b=void 0===b?!0:b;Ja(a,new Float32Array(this.W),c,b)};k.fa="";function Ga(a,c,b){a.fa=c;var d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="arraybuffer";d.onload=function(){a.W=d.response;b()};d.send()}k.H=null;k.W=null;k.X=null;k.T=null;
k.l=function(a,c,b){this.T&&(c.useProgram(this.T),Ka(a),La(a,"m",Ma(b.j)),Na(a,b),Oa(a,b),Pa(a),c.bindBuffer(c.ARRAY_BUFFER,this.X),c.vertexAttribPointer(0,4,c.FLOAT,!1,0,0),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.drawArrays(c.TRIANGLES,0,this.ga),Pa(a,!1))};k.ga=0;function B(a,c){this.a=a;this.b=c}B.prototype.abs=function(){return Math.sqrt(this.a*this.a+this.b*this.b)};function Q(a,c){return new B(a.a+c.a,a.b+c.b)}function R(a,c){var b=c.a*c.a+c.b*c.b;return new B((a.a*c.a+a.b*c.b)/b,(a.b*c.a-a.a*c.b)/b)}B.prototype.b=0;var Qa=new B(Infinity,Infinity);function S(a,c){return new B(a.a*c.a-a.b*c.b,a.a*c.b+a.b*c.a)}function Ra(a){return new B(-a.a,-a.b)}var ga=new B(1,0);B.prototype.a=0;function y(a){return new B(a,0)}
function Sa(a){if(!a.a&&!a.b)return T();var c=a.abs();return new B(Math.sqrt(.5*(c+a.a)),(Math.sign(a.b)||1)*Math.sqrt(.5*(c-a.a)))}function U(a,c){return new B(a.a-c.a,a.b-c.b)}function T(){return new B(0,0)};function Ha(a,c,b){function d(a){e.useProgram(h);e.bindBuffer(e.ARRAY_BUFFER,c.J);e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);n=e.getUniformLocation(h,"sheet");e.uniform1i(n,a);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.drawArrays(e.TRIANGLES,0,3)}b=void 0===b?!1:b;var e=c.g,f=O("DomainColouring"),g=Ta(a);f[1]=[g,l["Common.glsl"],f[1]].join("\n");var h=P(c,f),n,f=C(a);a=V(a,f.length?f[f.length-1]:"y");for(var f=[],m=1;m<=a;m++)va(c,d.bind(null,m),b),g=M(c,b?c.B:c.w),f[m-1]=wa(g);return f}
function N(a,c){var b=document.createElement("a");b.href=c;b.download=a;b.style.display="none";document.body.appendChild(b);b.click();document.body.removeChild(b)}function Ia(a,c,b,d){b=void 0===b?"sheet":b;a=Ha(a,c,void 0===d?!0:d);c=0;for(d=a.length;c<d;c++)N(b+(c+1)+".png",a[c])}
function Ja(a,c,b,d){b=void 0===b?"surface":b;d=void 0===d?!0:d;var e,f,g,h,n,m,q,p=-Infinity,r=Infinity;m=c.byteLength/c.BYTES_PER_ELEMENT/4;var z=[];for(f=0;f<4*m;f+=4)e=c[f],g=c[f+1],h=c[f+2],n=c[f+3],z.push([e,g,h]),r=Math.min(r,Math.min(h,n)),p=Math.max(p,Math.max(h,n));e=p-r;var x=[];for(f=2;f<4*m;f+=4)g=(c[f]-r)/e,h=(c[f+1]-r)/e,x.push([g,h]);c=[];for(f=1;f<=m;f+=3)e=f+1,g=f+2,c.push([f,e,g]);q=z.map(function(a,b){var c=x[b];return z.findIndex(function(b,d){d=x[d];return a[0]===b[0]&&a[1]===
b[1]&&a[2]===b[2]&&c[0]===d[0]&&c[1]===d[1]})});var E=Array.from(new Set(q)),z=E.map(function(a){return z[a]}),x=E.map(function(a){return x[a]});c=c.map(function(a){return a.map(function(a){return E.findIndex(function(b){return b===q[a-1]})+1})});f=z.map(function(a){return"v "+a[0]+" "+a[1]+" "+a[2]});m=x.map(function(a){return"vt "+a[0]+" "+a[1]});c=c.map(function(a){var b=a[0],c=a[1];a=a[2];return"f "+b+"/"+b+" "+c+"/"+c+" "+a+"/"+a});e=["mtllib "+b+".mtl","usemtl surface","s 1"];e=e.concat(f,m,
c);e="data:text/plain,"+encodeURIComponent(e.join("\n"));N(b+".obj",e);var t=a.g,I=P(a,O("Export")),ka;va(a,function(){t.useProgram(I);t.bindBuffer(t.ARRAY_BUFFER,a.J);t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0);ka=t.getUniformLocation(I,"minValue");t.uniform1f(ka,r);ka=t.getUniformLocation(I,"maxValue");t.uniform1f(ka,p);t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);t.drawArrays(t.TRIANGLES,0,3)},d);d=M(a,d?a.B:a.w);N(b+".png",wa(d));d=["newmtl surface","map_Kd "+b+".png","illum 0"];d="data:text/plain,"+
encodeURIComponent(d.join("\n"));N(b+".mtl",d)}function wa(a){var c=Math.sqrt(a.length/4),b=document.createElement("canvas");b.width=c;b.height=c;var d=b.getContext("2d"),e=d.createImageData(b.width,b.height);e.data.set(a);d.putImageData(e,0,0);a=document.createElement("canvas");a.width=c;a.height=c;c=a.getContext("2d");c.translate(0,a.height-1);c.scale(1,-1);c.drawImage(b,0,0);return a.toDataURL()};function Ua(a){var c=[],b,d;if(da(a))return[W(ea(a))];if(1===C(a).length)for(a=Va(a),b=0,d=a.length;b<d;b++)c[b]=W(a[b]);else if(2===C(a).length){b=C(a);var e=b[0];a=X(a,b[1]);b=0;for(d=a.length;b<d;b++)c[b]=Y(e,Ua(a[b]))}return c}function W(a){return"vec2 ("+a.a.toPrecision(8)+", "+a.b.toPrecision(8)+")"}
function Wa(a,c){a=Ua(a).reverse();for(var b=Xa-a.length+1,d=W(T()),e=0;e<b;e++)a.push(d);c=["void f (in vec2 "+c+", out vec2 cs[N+1])","{"];for(b=0;b<=Xa;b++)c.push("cs["+b+"] = "+a[b]+";");c.push("}");return c.join("\n")}function Ya(a,c,b){a=X(Za(a,c),b);for(var d=[],e=0,f=a.length;e<f;e++)d[e]=Y(c,Ua(a[e]));return["vec2 fx (in vec2 "+c+", in vec2 "+b+")","{","    return "+Y(b,d)+";","}"].join("\n")}
function $a(a,c,b){a=X(Za(a,b),c);for(var d=[],e=0,f=a.length;e<f;e++)d[e]=Y(b,Ua(a[e]));return["vec2 fy (in vec2 "+c+", in vec2 "+b+")","{","    return "+Y(c,d)+";","}"].join("\n")}function Y(a,c){for(var b=c[0],d=1,e=c.length;d<e;d++)b="vec2 (1.0000000, 0.0000000)"===b?a:"vec2 (-1.0000000, 0.0000000)"===b?"-"+a:"cm ("+a+","+b+")","vec2 (0.0000000, 0.0000000)"!==c[d]&&(b+="+"+c[d]);return b}
function ab(a,c,b){var d,e,f,g,h=X(a,b);d=0;for(f=h.length;d<f;d++){var n=h[d].a;e=0;for(g=n.length;e<g;e++){var m=n[e];n[e]=new w(y(m.b.abs()),m.a)}h[d]=new v(n)}d=h[0];d=bb(d,c,V(d,c));a=bb(a,b,V(a,b));a=cb(Va(a));b=["float M (in vec2 "+c+", in float rho)","{","    vec2 r = vec2 (length ("+c+") + rho, 0.0);","    float a["+h.length+"];","    a[0] = length ("+W(ea(d))+");"];d=0;for(f=a.length;d<f;d++)b.push("    a[0] *= distance ("+c+", "+W(a[d])+") - rho;");d=1;for(f=h.length;d<f;d++)b.push("    a["+
d+"] = length ("+Y("r",Ua(h[d]))+");");b=b.concat(["    float m = a[1] / a[0];","    for (int j = 2; j < "+h.length+"; j++) {","        m = max (m, pow (a[j] / a[0], 1.0 / float (j)));","    }","    return 2.0 * m;","}"]);return b.join("\n")}
function db(a,c,b){var d=bb(a,b,V(a,b)),e=Za(a,b);b=eb(b,a,e);e=b.a;(a=e.length)||console.error("matrix must be non-empty");for(var f=0;f<a;f++)e[f].length!==a&&console.error("matrix must be square");f=b;for(e=1;e<a;e++){for(var f=f.a,g=f[0][0].b(),h=[],n=0,m=f.length;n<m;n++){h[n]=[];for(var q=0;q<m;q++)if(q<n)h[n][q]=g;else if(q===n){for(var p=g,r=q+1;r<m;r++)var z=ba(f[r][r]),p=aa(p,z);h[n][q]=p}else h[n][q]=f[n][q]}f=(new fb(h)).a;g=b.a;f[0].length!==g.length&&console.error("matrix dimensions must match");
h=[];n=f.length;m=g[0].length;q=f[0][0].b();for(p=0;p<n;p++)for(h[p]=[],r=0;r<m;r++){for(var z=q,x=0,E=f[0].length;x<E;x++)var t=ca(f[p][x],g[x][r]),z=aa(z,t);h[p][r]=z}f=new fb(h)}b=f.a[0][0];a=a%2?b:ba(b);d=cb(Va(d));f=cb(Va(a));e=[];a=0;for(b=d.length;a<b;a++)isFinite(d[a].abs())&&e.push(d[a]);a=0;for(b=f.length;a<b;a++)isFinite(f[a].abs())&&e.push(f[a]);d=["float rho (in vec2 "+c+") {","    float d = 100.0;"];a=0;for(b=e.length;a<b;a++)d.push("    d = min (d, distance ("+c+", "+W(e[a])+"));");
d=d.concat(["    return 0.999 * d;","}"]);return d.join("\n")}var Xa=8;
function Ta(a){var c=C(a),b=2>c.length?"x":c[0],c=c.length?c[c.length-1]:"y";return[["#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif","const int N = "+Xa+";","const int sheets = "+V(a,c)+";","\n/* complex multiplication */\nvec2 cm (in vec2 a, in vec2 b)\n{\n    return vec2 (a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x);\n}"].join("\n"),Wa(a,b),Ya(a,b,c),$a(a,b,c),db(a,b,c),ab(a,b,c)].join("\n\n")};function gb(a,c){var b=hb(),d=a.g;c.i=b.length/2;d.enableVertexAttribArray(0);c.U=d.createBuffer();Fa(c,a);d.enableVertexAttribArray(1);this.b=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,this.b);d.bufferData(d.ARRAY_BUFFER,new Float32Array(b),d.STATIC_DRAW);c.I=d.createFramebuffer();b=O("Initial");b[0]=[c.F,b[0]].join("\n");b[1]=Ea(c,b[1]);this.a=P(a,b)}gb.prototype.b=null;gb.prototype.a=null;
gb.prototype.l=function(a,c,b){a=c.h;var d=c.m;b.useProgram(this.a);b.enableVertexAttribArray(0);b.bindBuffer(b.ARRAY_BUFFER,c.U);b.vertexAttribPointer(0,1,b.FLOAT,!1,0,0);b.enableVertexAttribArray(1);b.bindBuffer(b.ARRAY_BUFFER,this.b);b.vertexAttribPointer(1,2,b.FLOAT,!1,0,0);b.bindFramebuffer(b.FRAMEBUFFER,c.I);b.disable(b.DEPTH_TEST);b.viewport(0,0,2048,2048);for(var e=b.getUniformLocation(this.a,"computedRoots"),f=c.A,g,h=0;h<=f+1;h+=2)g=h<f?h/2+1:0,b.bindTexture(b.TEXTURE_2D,d[g]),b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,2048,2048,0,b.RGBA,b.FLOAT,null),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d[g],0),b.uniform1i(e,h),b.drawArrays(b.POINTS,0,c.i);g=0;for(e=d.length;g<e;g++)b.activeTexture(b.TEXTURE0+g),b.bindTexture(b.TEXTURE_2D,null);
b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0);b.bindFramebuffer(b.FRAMEBUFFER,null);b.bindBuffer(b.ARRAY_BUFFER,null);b.disableVertexAttribArray(1);c.h=d;c.m=a};function fb(a){this.a=a}fb.prototype.a=null;function hb(){for(var a=[],c=-10;10>c;c++)for(var b=-10;10>b;b++)a=(c+b)%2?a.concat([c,b,c+1,b+1,c,b+1,c,b,c+1,b,c+1,b+1]):a.concat([c,b,c+1,b,c,b+1,c+1,b,c+1,b+1,c,b+1]);return a.map(function(a){return a/2})};function ib(a,c,b){return a+b*(c-a)};function A(a){this.value=a}function jb(a){var c={};a=a.value;for(var b in a)c[b]=a[b];return new A(c)};function D(a){var c=arguments;return function(a){for(var b,e=[],f=0,g=c.length;f<g;f++)if(b=(0,c[f])(a))e.push(b);else return Array.prototype.unshift.apply(a,e),null;return e}}function la(a){var c=F("("),b=F(")");return function(d){return(d=D(c,a,b)(d))?d[1]:null}}function oa(a){return a.length?null:!0}function na(a){return function(c){return(c[0]||{}).type===a?c.shift():null}}function ja(a){return function(c){for(var b=a(c),d=[];null!==b;)d.push(b),b=a(c);return d}}
function ha(a){var c=arguments;return function(a){for(var b,e=0,f=c.length;e<f;e++)if(b=(0,c[e])(a))return b;return null}}function ia(a,c){return function(b){b=D(a,c)(b);return null===b?null:{type:"prefix",value:b[0].value,first:b[1]}}}function F(a){return function(c){return(c[0]||{}).value===a?c.shift():null}};function v(a){a.length?this.a=kb(a):this.a=[new w(T(),new A({}))]}function aa(a,c){return new v(kb(a.a.concat(c.a)))}function bb(a,c,b){a=a.a;for(var d=[],e=0,f=a.length;e<f;e++){var g=a[e];if((g.a.value[c]||0)===b){var h=jb(g.a);delete h.value[c];d.push(new w(g.b,h))}}return new v(d)}function X(a,c){for(var b=V(a,c),d=[],e=0;e<=b;e++)d[e]=bb(a,c,b-e);return d}
function Va(a){var c=C(a),b=c.length;1<b&&console.error("Polynomial is not univariate");a=X(a,0<b?c[0]:"x");for(var c=[],b=0,d=a.length;b<d;b++)c[b]=ea(a[b]);return c}function ea(a){var c=T();a=a.a;for(var b=0,d=a.length;b<d;b++){var e=a[b],f=e.a.value;null!==f&&Object.keys(f).length||(c=Q(c,e.b))}return c}function V(a,c){var b=0;a=a.a;for(var d=0,e=a.length;d<e;d++)b=Math.max(b,a[d].a.value[c]||0);return b}
function Za(a,c){a=a.a;for(var b=[],d=0,e=a.length;d<e;d++){var f=a[d].a,g=f.value[c]||0;if(0<g){var h=S(a[d].b,y(g)),f=jb(f);f.value[c]=g-1;b.push(new w(h,f))}}return new v(b)}function da(a){return!C(a).length&&!!a.a.length}
function lb(a,c,b){for(var d=a.length-1,e=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],f,g,h,n,m=1;m<=b;m++){h=T();f=T();g=a[0];for(n=1;n<=d;n++)h=Q(f,S(h,c)),f=Q(g,S(f,c)),g=Q(a[n],S(g,c));if(1E-14>g.abs())break;f=R(f,g);n=S(f,f);g=U(n,R(S(y(2),h),g));h=Sa(S(y(d-1),U(S(y(d),g),n)));g=Q(f,h);f=U(f,h);g.abs()<f.abs()&&(g=f);f=1E-14<g.abs()?R(y(d),g):S(y(c.abs()+1),new B(Math.cos(m),Math.sin(m)));if(1E-14>f.abs())break;!(m%20)&&m<b-19&&(f=S(f,y(e[Math.floor(m/20)])));c=U(c,f)}return c}
function ca(a,c){a=a.a;c=c.a;for(var b=[],d=0,e=a.length;d<e;d++)for(var f=0,g=c.length;f<g;f++){var h=void 0,n=a[d],m=c[f],q={},p=n.a.value,r=m.a.value;for(h in p)q[h]=p[h]+(r[h]||0);for(h in r)q[h]=r[h]+(p[h]||0);b.push(new w(S(n.b,m.b),new A(q)))}return new v(kb(b))}function ba(a){a=a.a;for(var c=[],b=0,d=a.length;b<d;b++){var e=a[b];c.push(new w(Ra(e.b),e.a))}return new v(c)}
function fa(a,c){var b=new v([new w(y(1),new A({}))]);for(Number.isInteger(c)||console.error("Non-integer power of Polynomial!");0<c;c--)b=ca(b,a);return b}v.prototype.pow=function(a){return fa(this,a)};function mb(a){var c=a[0],b=a[1];a=a[2];if(!a.a&&!a.b)return[T(),Ra(R(b,c))];var d=Sa(U(S(b,b),S(y(4),S(c,a))));0<=b.a&&(d=Ra(d));return[R(U(d,b),S(y(2),c)),R(S(y(2),a),U(d,b))]}
function cb(a){var c=[],b=a,d=a.length-1;if(0>=d)return[];var e=a[0];if(!e.a&&!e.b)return c=cb(a.slice(1)),c.push(Qa),c;if(1===d)c[0]=Ra(R(a[1],a[0]));else if(2===d)c=mb(a);else{for(e=0;e<d-2;e++){c[e]=lb(a,T(),200);c[e]=lb(b,c[e],1);for(var f=c[e],g=[a[0]],h=1,n=a.length-1;h<n;h++)g[h]=Q(a[h],S(g[h-1],f));a=g}b=mb(a);c[d-2]=b[0];c[d-1]=b[1]}return c}function pa(a){var c=C(a);return V(a,c.length?c[c.length-1]:"y")}
function eb(a,c,b){function d(a){for(var b=[],c=0;c<a;c++)b[c]=nb();return b}function e(a,b){return d(b).concat(a).concat(d(f+g-a.length-b))}var f=V(c,a),g=V(b,a);c=X(c,a);a=X(b,a);b=[];for(var h=0;h<g;h++)b.push(e(c,h));for(c=0;c<f;c++)b.push(e(a,c));return new fb(b)}v.prototype.a=null;function C(a){a=a.a;for(var c=[],b={},d=0,e=a.length;d<e;d++){var f=a[d].a.value,g;for(g in f)b[g]||(c.push(g),b[g]=!0)}c.sort();return c}function nb(){return new v([])}v.prototype.b=nb;function Z(a,c,b,d){this.f=a;this.a=c;this.b=b;this.c=d}Z.prototype.abs=function(){return Math.sqrt(this.f*this.f+this.a*this.a+this.b*this.b+this.c*this.c)};function K(a,c){a=-a/2;c=-c/2;return ob(new Z(Math.cos(a),Math.sin(a),0,0),new Z(Math.cos(c),0,0,Math.sin(c)))}function pb(a,c,b){return new Z(ib(a.f,c.f,b),ib(a.a,c.a,b),ib(a.b,c.b,b),ib(a.c,c.c,b))}
function ob(a,c){return new Z(a.f*c.f-a.a*c.a-a.b*c.b-a.c*c.c,a.f*c.a+a.a*c.f+a.b*c.c-a.c*c.b,a.f*c.b-a.a*c.c+a.b*c.f+a.c*c.a,a.f*c.c+a.a*c.b-a.b*c.a+a.c*c.f)}function qb(a){var c=a.abs();return new Z(a.f/c,a.a/c,a.b/c,a.c/c)}function Ma(a){var c=a.f,b=a.a,d=a.b;a=a.c;return[c*c+b*b-d*d-a*a,2*b*d+2*c*a,2*b*a-2*c*d,0,2*b*d-2*c*a,c*c-b*b+d*d-a*a,2*d*a+2*c*b,0,2*b*a+2*c*d,2*d*a-2*c*b,c*c-b*b-d*d+a*a,0,0,0,0,c*c+b*b+d*d+a*a]}function Aa(a,c){return new Z(a.f-c.f,a.a-c.a,a.b-c.b,a.c-c.c)};function qa(){}k=qa.prototype;k.o=!1;k.P=[0,0];k.C=!1;k.D=!1;k.j=K(0,0);k.R=K(0,0);k.s=K(0,0);k.G=1;function xa(a,c){a.o||(a.P=c,a.D=!0,a.R=a.s)}function ya(a,c,b){if(a.D){var d=a.P;c-=d[0];b=d[1]-b;var d=Math.sqrt(c*c+b*b),e=a.R,f=d/Math.sqrt(1E4+d*d);a.s=qb(pb(e,ob(new Z(100/Math.sqrt(1E4+d*d),-f*b,f*c,0),e),.05))}}function Ba(a){if(a.o){var c=qb(new Z(.01,0,0,1)),c=ob(c,c);a.j=a.s=ob(a.j,c)}else a.j=qb(pb(a.j,a.s,.1))};function ra(a){a=this.g=a.getContext("webgl",{preserveDrawingBuffer:!0});a.enable(a.DEPTH_TEST);a=this.g;var c=Math.min(a.getParameter(a.MAX_TEXTURE_SIZE),8192);this.V=c;this.J=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.J);a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),a.STATIC_DRAW);a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0);a.enableVertexAttribArray(0);this.Y=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,this.Y);this.Z=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,
this.Z);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,c,c);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.Z);this.B=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.B);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,c,c,0,a.RGBA,a.UNSIGNED_BYTE,null);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.B,0);this.$=a.createFramebuffer();
a.bindFramebuffer(a.FRAMEBUFFER,this.$);this.aa=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.aa);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,2048,2048);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.aa);this.w=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.w);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,2048,2048,0,a.RGBA,
a.UNSIGNED_BYTE,null);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.w,0);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindBuffer(a.ARRAY_BUFFER,null);this.ja=P(this,O("FXAA"))}k=ra.prototype;k.V=8192;k.L=!1;k.M=!0;k.ja=null;function rb(a,c){void 0===a[c]&&(a[c]=a.g.getExtension(c),a[c]||alert("Required extension "+c+" not supported. Please try another browser or platform."))}
function O(a){return[l[a+".vert"],l[a+".frag"]]}k.g=null;
function P(a,c){a=a.g;var b=c[1],d=a.createShader(a.VERTEX_SHADER);a.shaderSource(d,c[0]);a.compileShader(d);a.getShaderParameter(d,a.COMPILE_STATUS)||console.log(a.getShaderInfoLog(d));c=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(c,b);a.compileShader(c);a.getShaderParameter(c,a.COMPILE_STATUS)||console.log(a.getShaderInfoLog(c));b=a.createProgram();a.attachShader(b,d);a.attachShader(b,c);a.linkProgram(b);a.getProgramParameter(b,a.LINK_STATUS)||console.log(a.getProgramInfoLog(b));a.useProgram(b);
return b}
function M(a,c,b){var d;d=void 0===d?0:d;var e=a.g,f=e.getParameter(e.FRAMEBUFFER_BINDING),g=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,g);e.bindTexture(e.TEXTURE_2D,c);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0);
if(e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return e.bindTexture(e.TEXTURE_2D,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),e.bindFramebuffer(e.FRAMEBUFFER,f),e.deleteFramebuffer(g),null;c===a.w?(a=new Uint8Array(16777216),e.readPixels(0,0,2048,2048,e.RGBA,e.UNSIGNED_BYTE,a)):c===a.B?(c=a.V,a=new Uint8Array(4*c*c),e.readPixels(0,0,c,c,e.RGBA,e.UNSIGNED_BYTE,a)):(a=new Float32Array(16777216),e.readPixels(0,0,2048,2048,e.RGBA,e.FLOAT,a));
c=e.getError();e.bindTexture(e.TEXTURE_2D,null);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0);e.bindFramebuffer(e.FRAMEBUFFER,f);e.deleteFramebuffer(g);return c!==e.NO_ERROR?null:b?a.subarray(d,d+b):a}k.u=null;function za(a,c){var b=a.g;sb(a,function(){a.u.l(a,b,c)})}k.J=null;k.Y=null;k.Z=null;k.B=null;k.$=null;k.aa=null;k.w=null;k.S=!1;function Ka(a){var c=a.g;c.uniform1f(c.getUniformLocation(c.getParameter(c.CURRENT_PROGRAM),"clipping"),a.L?1:0)}
function Oa(a,c){var b=a.g,d=b.getParameter(b.VIEWPORT),b=d[2],d=d[3];if(c.C){var e=c.G;c=-7.5*e;var f=-7.5*e,g=7.5*e,e=7.5*e,h=Math.min(d/b,1),b=Math.min(b/d,1),b=[2*h/(g-f),0,0,0,0,2*b/(e-c),0,0,0,0,-.01,0,-h*(g+f)/(g-f),-b*(e+c)/(e-c),-0,1]}else c=1/Math.tan(45*c.G/2*Math.PI/180),b=[c/(0<d?b/d:b),0,0,0,0,c,0,0,0,0,101/-99,-1,0,0,200/-99,0];La(a,"p",b)}
function Pa(a,c){var b=a.g;a.S&&!1!==c?(b.blendFunc(b.SRC_ALPHA,b.ONE),b.enable(b.BLEND),b.disable(b.DEPTH_TEST)):(b.disable(b.BLEND),b.enable(b.DEPTH_TEST),b.depthFunc(b.LESS))}function La(a,c,b){a=a.g;a.uniformMatrix4fv(a.getUniformLocation(a.getParameter(a.CURRENT_PROGRAM),c),!1,b)}function Na(a,c){La(a,"v",c.C?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-20,1])}
function sb(a,c){if(a.M){va(a,c);c=a.g;var b=a.ja;c.useProgram(b);var d=c.getUniformLocation(b,"width");c.uniform1f(d,c.canvas.width);d=c.getUniformLocation(b,"height");c.uniform1f(d,c.canvas.height);c.bindBuffer(c.ARRAY_BUFFER,a.J);c.vertexAttribPointer(0,2,c.FLOAT,!1,0,0);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,a.w);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);c.drawArrays(c.TRIANGLES,0,3)}else c()}
function va(a,c,b){var d=a.g;(void 0===b?0:b)?(b=a.V,d.bindFramebuffer(d.FRAMEBUFFER,a.Y),d.viewport(0,0,b,b)):(d.bindFramebuffer(d.FRAMEBUFFER,a.$),d.viewport(0,0,2048,2048));c();d.viewport(0,0,d.canvas.width,d.canvas.height);d.bindFramebuffer(d.FRAMEBUFFER,null)};function tb(a,c){var b=O("Subdivision");b[0]=[c.F,b[0]].join("\n");b[1]=Ea(c,b[1]);this.a=P(a,b)}tb.prototype.a=null;
tb.prototype.l=function(a,c,b){var d,e=c.h,f=c.m,g=this.a;b.useProgram(g);var h=M(a,e[0]),n=[0,1,0,0,1,0,1,0,2,0,0,1,0,1,0,0,1,0,1,0,2,.5,0,.5,3,0,1,0,4,0,0,1,5,.5,0,.5,0,1,0,0,1,0,1,0,2,0,.5,.5,3,0,.5,.5,4,0,0,1,5,1,0,0,0,1,0,0,1,0,1,0,2,.5,0,.5,3,0,.5,.5,4,0,0,1,5,.5,0,.5,6,.5,0,.5,7,0,1,0,8,0,.5,.5,0,1,0,0,1,.5,.5,0,2,0,0,1,3,0,0,1,4,.5,.5,0,5,0,1,0,0,1,0,0,1,.5,.5,0,2,.5,0,.5,3,.5,0,.5,4,.5,.5,0,5,0,0,1,6,0,1,0,7,0,0,1,8,.5,.5,0,0,1,0,0,1,.5,.5,0,2,0,.5,.5,3,0,0,1,4,1,0,0,5,0,.5,.5,6,0,.5,.5,
7,.5,.5,0,8,0,1,0,0,1,0,0,1,.5,.5,0,2,.5,0,.5,3,.5,.5,0,4,0,1,0,5,0,.5,.5,6,0,.5,.5,7,0,0,1,8,.5,0,.5,9,.5,.5,0,10,0,.5,.5,11,.5,0,.5],m=[0,3,9,15,24,30,39,48],q=[3,6,6,9,6,9,9,12];b.bindFramebuffer(b.FRAMEBUFFER,c.I);var p=[];a=0;for(d=e.length;a<d;a++)b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,e[a]),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),
b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),p[a]=a;b.uniform1iv(b.getUniformLocation(g,"oldSamplers"),p);b.disable(b.DEPTH_TEST);b.viewport(0,0,2048,2048);var g=b.getUniformLocation(this.a,"computedRoots"),p=c.A,r=[],z=[],x=[],E=0;a=0;for(d=c.i/3;a<d;a++){var t=4*h[12*a+3]+2*h[12*a+7]+h[12*a+11],I=m[t],t=q[t];x.push(n.slice(4*I,4*(I+t)));for(I=0;I<t;I++)r.push(3*a),z.push(E);E+=t}x=Array.prototype.concat.apply([],x);h=b.createBuffer();b.enableVertexAttribArray(0);b.bindBuffer(b.ARRAY_BUFFER,
h);b.bufferData(b.ARRAY_BUFFER,new Float32Array(x),b.STATIC_DRAW);b.vertexAttribPointer(0,4,b.FLOAT,!1,0,0);n=b.createBuffer();b.enableVertexAttribArray(1);b.bindBuffer(b.ARRAY_BUFFER,n);b.bufferData(b.ARRAY_BUFFER,new Float32Array(r),b.STATIC_DRAW);b.vertexAttribPointer(1,1,b.FLOAT,!1,0,0);m=b.createBuffer();b.enableVertexAttribArray(2);b.bindBuffer(b.ARRAY_BUFFER,m);b.bufferData(b.ARRAY_BUFFER,new Float32Array(z),b.STATIC_DRAW);b.vertexAttribPointer(2,1,b.FLOAT,!1,0,0);for(d=0;d<=p+1;d+=2)a=d<p?
d/2+1:0,b.activeTexture(b.TEXTURE0+e.length),b.bindTexture(b.TEXTURE_2D,f[a]),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,2048,2048,0,b.RGBA,b.FLOAT,null),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,f[a],0),b.uniform1i(g,d),b.drawArrays(b.POINTS,0,E);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0);a=0;for(d=e.length+1;a<d;a++)b.activeTexture(b.TEXTURE0+
a),b.bindTexture(b.TEXTURE_2D,null);b.bindFramebuffer(b.FRAMEBUFFER,null);b.bindBuffer(b.ARRAY_BUFFER,null);b.deleteBuffer(n);b.deleteBuffer(m);b.deleteBuffer(h);b.disableVertexAttribArray(1);b.disableVertexAttribArray(2);c.i=E;c.h=f;c.m=e};function ub(a,c){var b=O("SubdivisionPre");b[0]=[c.F,b[0]].join("\n");this.a=P(a,b)}ub.prototype.a=null;
ub.prototype.l=function(a,c,b){var d=c.h[0],e=c.m[0];b.useProgram(this.a);Fa(c,a);b.vertexAttribPointer(0,1,b.FLOAT,!1,0,0);b.bindFramebuffer(b.FRAMEBUFFER,c.I);b.bindTexture(b.TEXTURE_2D,e);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,e,0);b.bindTexture(b.TEXTURE_2D,null);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,d);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.uniform1i(b.getUniformLocation(this.a,"sampler"),0);b.disable(b.DEPTH_TEST);b.viewport(0,0,2048,2048);b.drawArrays(b.POINTS,0,c.i);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0);b.bindFramebuffer(b.FRAMEBUFFER,null);b.bindBuffer(b.ARRAY_BUFFER,null);c.h[0]=e;c.m[0]=d};function ua(a,c,b){this.a=c;this.b=b;this.A=pa(c);if(2===C(c).length)if(2>this.A)console.log("There must be at least two sheets!");else{rb(a,"OES_texture_float");b=a.g;-1!==b.getSupportedExtensions().indexOf("WEBGL_color_buffer_float")&&rb(a,"WEBGL_color_buffer_float");for(var d=a.g,e=[],f=[],g=0;5>g;g++)e[g]=d.createTexture(),d.bindTexture(d.TEXTURE_2D,e[g]),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,
0,d.RGBA,2048,2048,0,d.RGBA,d.FLOAT,null),f[g]=d.createTexture(),d.bindTexture(d.TEXTURE_2D,f[g]),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,2048,2048,0,d.RGBA,d.FLOAT,null);d.bindTexture(d.TEXTURE_2D,null);this.h=e;this.m=f;d=this.h[0];e=a.g;f=e.getParameter(e.FRAMEBUFFER_BINDING);g=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,g);var h=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,
h);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,2048,2048);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,h);e.bindTexture(e.TEXTURE_2D,d);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,d,0);
var n=e.checkFramebufferStatus(e.FRAMEBUFFER),m=e.getError(),n=n===e.FRAMEBUFFER_COMPLETE&&m===e.NO_ERROR;e.bindTexture(e.TEXTURE_2D,null);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0);e.bindRenderbuffer(e.RENDERBUFFER,null);e.deleteRenderbuffer(h);e.bindFramebuffer(e.FRAMEBUFFER,f);e.deleteFramebuffer(g);d=null!==M(a,d);n&&d?d=!0:(alert((n||d?n?"Reading from float textures not supported.":"Rendering to float textures not supported.":"Rendering to and reading from float textures not supported.")+
" Please try another browser or platform."),d=!1);if(d){this.ha=l["Common.glsl"].trim();this.ia=Ta(c);this.F=l["Textures.glsl"];this.f=new gb(a,this);this.f.l(a,this,b);this.O=new ub(a,this);this.N=new tb(a,this);for(c=0;c<this.b;c++)this.O.l(a,this,b),this.N.l(a,this,b);this.c=new Da(a,this);this.c.l(a,this,b);c=O("Surface");c[0]=[this.F,c[0]].join("\n");c[1]=Ea(this,c[1]);this.K=P(a,c);a=b.canvas;b.viewport(0,0,a.width,a.height)}}else console.log("Equation must be bivariate!")}k=ua.prototype;
k.ha="";k.ia="";k.ba=function(a,c){return Ha(this.a,a,void 0===c?!1:c)};k.ca=function(a,c){c=void 0===c?"surface.bin":c;a=M(a,this.h[0],4*this.i);a=URL.createObjectURL(new Blob([a],{type:"application/octet-binary"}));N(c,a)};k.da=function(a,c,b){Ia(this.a,a,void 0===c?"sheet":c,void 0===b?!0:b)};k.ea=function(a,c,b){c=void 0===c?"surface":c;b=void 0===b?!0:b;var d=M(a,this.h[0],4*this.i);Ja(a,d,c,b)};
function Fa(a,c){c=c.g;for(var b=[],d=0;d<a.i;d++)b[d]=d;c.bindBuffer(c.ARRAY_BUFFER,a.U);c.bufferData(c.ARRAY_BUFFER,new Float32Array(b),c.STATIC_DRAW)}k.I=null;k.U=null;k.i=0;k.K=null;
k.l=function(a,c,b){this.K&&(c.useProgram(this.K),Ka(a),La(a,"m",Ma(b.j)),Na(a,b),Oa(a,b),Pa(a),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.h[0]),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.uniform1i(c.getUniformLocation(this.K,"sampler"),0),Fa(this,a),c.vertexAttribPointer(0,1,
c.FLOAT,!1,0,0),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.drawArrays(c.TRIANGLES,0,this.i),Pa(a,!1))};k.A=0;k.h=[];k.m=[];k.F="";function Ea(a,c){return[a.ia,a.ha,c].join("\n")};function w(a,c){this.b=a;this.a=c}w.prototype.b=null;w.prototype.a=null;
function kb(a){function c(a,d){if(d.length){if(1===d.length)return a.push(d[0]),a;for(var b=d.pop(),f=b.b,b=b.a,g=[],h=0,n=d.length;h<n;h++){var m;a:{m=void 0;var q=b,p=d[h].a;for(m in q.value)if(!p.value.hasOwnProperty(m)||q.value[m]!==p.value[m]){m=!1;break a}for(m in p.value)if(!q.value.hasOwnProperty(m)||q.value[m]!==p.value[m]){m=!1;break a}m=!0}m?f=Q(f,d[h].b):g.push(d[h])}a.push(new w(f,b));return c(a,g)}return a}return c([],a)};function vb(){this.a=[["\\d*\\.\\d*","number"],["\\d+","number"],["i","imaginary"],["[a-hj-z]","variable"],["[\\+\\*\\^-]","operator"],["[\\(\\)]","parenthesis"]]}function ma(a){for(var c=(new vb).a,b="(?:",d=0,e=c.length;d<e;d++)b+=(0<d?"|(":"(")+c[d][0]+")";b=new RegExp(b+")","g");for(d=[];null!==(e=b.exec(a));){var f=e[0];d.push({type:c[e.slice(1).indexOf(f)][1],value:f})}return d};
})();//# sourceMappingURL=ComplexCurves.js.map

